@{
    Layout = null;
}
@model List<APPDEV_PROJECT.Models.Entities.Notification>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HanapBuhay - Notifications</title>
    <link rel="stylesheet" href="~/Styles/NotifPage_W_styles.css">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <img src="~/Images/HanapBuhay_Logo.png" alt="HanapBuhay Logo">
            </div>

            <div class="nav-links">
                <a href="@Url.Action("JobReqPage_W", "Worker")"><button class="home-btn"><ion-icon name="home-outline"></ion-icon></button></a>
                <a href="@Url.Action("ChatPage_W", "Worker")"><button class="chat-btn"><ion-icon name="chatbubble-ellipses-outline"></ion-icon></button></a>
                <a href="@Url.Action("NotifPage_W", "Worker")"><button class="notif-btn"><ion-icon name="notifications-outline" class="active"></ion-icon></button></a>
                <a href="@Url.Action("Profile_W", "Worker")"><button class="person-btn"><ion-icon name="person-outline"></ion-icon></button></a>
                <a href="@Url.Action("LandingPage", "Home")"><button class="logout-btn"><ion-icon name="log-in-outline"></ion-icon></button></a>
            </div>
        </div>
    </header>

    <!-- Notifications Container -->
    <div class="notifications-container">
        <!-- Left Side - Notifications List -->
        <div class="notifications-main">
            <h1 class="page-title">Notifications</h1>

            <div class="notifications-filters">
                <button class="filter-btn active">All</button>
                <button class="filter-btn">Unread</button>
                <button class="filter-btn">Booking</button>
                <button class="sort-btn">
                    <ion-icon name="funnel-outline"></ion-icon>
                    Newest
                </button>
            </div>

            <div class="notifications-list">
                @if (Model == null || Model.Count == 0)
                {
                    <div style="text-align: center; padding: 60px 20px; color: #999;">
                        <ion-icon name="notifications-off-outline" style="font-size: 60px; display: block; margin-bottom: 15px;"></ion-icon>
                        <p style="font-size: 16px;">No notifications yet</p>
                    </div>
                }
                else
                {
                    @foreach (var notification in Model)
                    {
                        <div class="notification-item" data-type="@notification.Type" data-read="@notification.IsRead.ToString().ToLower()" data-timestamp="@((long)(DateTime.Now - notification.CreatedAt).TotalSeconds)">
                            <div class="notification-icon" style="background: #FFE5B4;">
                                @if (notification.Type == "booking")
                                {
                                    <ion-icon name="calendar-outline"></ion-icon>
                                }
                                else if (notification.Type == "message")
                                {
                                    <ion-icon name="chatbubble-outline"></ion-icon>
                                }
                                else if (notification.Type == "review")
                                {
                                    <ion-icon name="star-outline"></ion-icon>
                                }
                                else
                                {
                                    <ion-icon name="megaphone-outline"></ion-icon>
                                }
                            </div>
                            <div class="notification-content">
                                <div class="notification-text">
                                    <strong>@notification.Title</strong> - @notification.Message
                                </div>
                                <div class="notification-time">@{
                                    var diff = DateTime.Now - notification.CreatedAt;
                                    if (diff.TotalSeconds < 60)
                                    {
                                        @((int)diff.TotalSeconds + " secs ago")
                                    }
                                    else if (diff.TotalMinutes < 60)
                                    {
                                        @((int)diff.TotalMinutes + " mins ago")
                                    }
                                    else if (diff.TotalHours < 24)
                                    {
                                        @((int)diff.TotalHours + " hours ago")
                                    }
                                    else
                                    {
                                        @((int)diff.TotalDays + " days ago")
                                    }
                                }</div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>

        <!-- Right Side - Booking Info -->
        <div class="service-sidebar">
            <div class="service-card">
                <div class="service-card-header">
                    <ion-icon name="calendar-outline"></ion-icon>
                    <h3>Active Bookings</h3>
                </div>
                <div class="service-card-content">
                    <p>â€¢ @(Model?.Count(n => n.Type == "booking" && !n.IsRead) ?? 0) New Booking Request(s)</p>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Check Job Requests for details</p>
                </div>
            </div>

            <div class="service-card">
                <div class="service-card-header">
                    <ion-icon name="time-outline"></ion-icon>
                    <h3>Notification Stats</h3>
                </div>
                <div class="service-card-content">
                    <div class="service-stat">
                        <span class="stat-number">@(Model?.Count ?? 0)</span>
                        <span class="stat-label">Total Notifications</span>
                    </div>
                    <div class="service-stat">
                        <span class="stat-number">@(Model?.Count(n => !n.IsRead) ?? 0)</span>
                        <span class="stat-label">Unread</span>
                    </div>
                    <div class="service-stat">
                        <span class="stat-number">@(Model?.Count(n => n.Type == "booking") ?? 0)</span>
                        <span class="stat-label">Bookings</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const filterBtns = document.querySelectorAll('.filter-btn');
        const sortBtn = document.querySelector('.sort-btn');
        const notificationItems = document.querySelectorAll('.notification-item');
        let currentFilter = 'all';
        let sortOrder = 'newest';

        // Filter functionality
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                filterBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.textContent.toLowerCase();
                applyFilters();
            });
        });

        // Sort functionality
        sortBtn.addEventListener('click', function() {
            sortOrder = sortOrder === 'newest' ? 'oldest' : 'newest';
            const icon = sortOrder === 'newest' ? 'caret-up-outline' : 'caret-down-outline';
            sortBtn.innerHTML = `<ion-icon name="${icon}"></ion-icon> ${sortOrder.charAt(0).toUpperCase() + sortOrder.slice(1)}`;
            applyFilters();
        });

        // Apply filters and sorting
        function applyFilters() {
            let visibleItems = [];

            notificationItems.forEach(item => {
                let show = false;
                const type = item.getAttribute('data-type');
                const isRead = item.getAttribute('data-read') === 'true';

                if (currentFilter === 'all') {
                    show = true;
                } else if (currentFilter === 'unread') {
                    show = !isRead;
                } else if (currentFilter === 'booking') {
                    show = type === 'booking';
                }

                if (show) {
                    item.style.display = 'flex';
                    visibleItems.push(item);
                } else {
                    item.style.display = 'none';
                }
            });

            // Sort visible items
            visibleItems.sort((a, b) => {
                const timestampA = parseInt(a.getAttribute('data-timestamp'));
                const timestampB = parseInt(b.getAttribute('data-timestamp'));

                if (sortOrder === 'newest') {
                    return timestampA - timestampB;
                } else {
                    return timestampB - timestampA;
                }
            });

            // Reorder items in DOM
            const notificationsList = document.querySelector('.notifications-list');
            visibleItems.forEach(item => {
                notificationsList.appendChild(item);
            });
        }
    </script>
</body>
</html>
